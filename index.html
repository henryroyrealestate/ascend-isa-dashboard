<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ascend ISA Dashboard</title>

<style>
    body { margin:0; font-family:Inter,sans-serif; background:#f4f7fb; color:#1e2a36; }
    .header { text-align:center; padding:30px 20px 15px; background:linear-gradient(180deg,#e7eef7,#f5f8fc); border-bottom:1px solid #d9e1ec; }
    .logo { width:260px; margin-top:10px; margin-bottom:5px; }
    h1 { font-size:40px; margin:0; font-weight:700; color:#1f3549; }
    .subtext{ font-size:17px; color:#526578; margin-bottom:5px; }

    .workhub{ max-width:900px; margin:20px auto 40px; background:white; padding:30px; border-radius:20px; box-shadow:0 10px 28px rgba(0,0,0,0.12); border:1px solid #e3e8ef;}
    .status-banner{ display:none; background:#15384a; color:white; padding:12px; border-radius:10px; text-align:center; font-size:17px; font-weight:600; margin-bottom:12px;}
    .error-banner{ display:none; background:#b42d2d; color:white; padding:12px; border-radius:10px; text-align:center; font-size:16px; font-weight:600; margin-bottom:12px;}
    .clocked-time{ display:none; text-align:center; font-size:15px; color:#30475e; margin-bottom:20px; font-weight:600;}

    .clock-btns{ display:flex; gap:20px; justify-content:center; margin-bottom:20px;}
    .clock-btn{ flex:1; padding:14px; border:none; border-radius:10px; color:white; font-size:16px; font-weight:600; cursor:pointer;}
    .clock-in{ background:#15384a;} .clock-in:hover{background:#1f4d67;}
    .clock-out{ background:#b02a2a;} .clock-out:hover{background:#c03a3a;}
    .disabled{ opacity:0.35; cursor:not-allowed;}

    .stats-box{ text-align:center; font-size:17px; font-weight:600; color:#2f3f50;}
    .secondary{ font-size:14px; color:#556475; margin-top:5px;}

    .progress-bar-bg{ width:100%; background:#e6edf5; height:18px; border-radius:10px; margin-top:15px; overflow:hidden;}
    .progress-bar-fill{ height:100%; width:0%; transition:width .4s ease;}
    .green{background:#28a745;} .yellow{background:#ffc107;} .red{background:#dc3545;}

    .agent-container{ display:flex; justify-content:center; gap:30px; margin-bottom:50px; padding:0 20px; flex-wrap:wrap;}
    .agent-card{ width:290px; background:white; padding:26px; border-radius:18px; box-shadow:0 8px 22px rgba(0,0,0,0.08); text-align:center;}
    .agent-card h2{ font-size:22px; margin-top:0; }

    .btn{ display:block; width:100%; margin:10px auto; padding:12px; background:#2b4a5a; color:white; border:none; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;}
    .btn:hover{ background:#3b6173;}

    .assignment-card{ max-width:900px; margin:0 auto 50px; background:white; padding:30px; border-radius:18px; box-shadow:0 8px 22px rgba(0,0,0,0.10);}
    .assignment-card h2{ text-align:center; font-size:26px; font-weight:700; color:#15384a; margin-bottom:10px;}

    .next-up-box{ background:#e9f1f6; padding:14px; border-left:6px solid #15384a; border-radius:10px; margin-bottom:20px; font-size:17px; font-weight:600; }

    .assignment-form{ display:grid; grid-template-columns:repeat(2,1fr); gap:20px; }
    .assignment-form input,
    .assignment-form textarea,
    .assignment-form select{
        padding:12px; border-radius:10px; border:1px solid #c9d3df; font-size:15px;
    }
    .assignment-form textarea{ grid-column:span 2; min-height:80px;}
    .assign-btn{ grid-column:span 2; padding:14px; font-size:17px; font-weight:700; background:#15384a; color:white; border:none; border-radius:12px; cursor:pointer;}
    .assign-btn:hover{ background:#1f4d67;}

    .generator-card{ max-width:900px; margin:0 auto 60px; background:white; padding:30px; border-radius:14px; box-shadow:0 4px 20px rgba(0,0,0,0.08);}
    .generator-card h2{text-align:center; font-size:26px; font-weight:700;}
    .generator-row{ display:flex; flex-wrap:wrap; gap:20px; justify-content:center; margin-bottom:30px;}
    .gen-btn{ background:#1d4e89; border:none; color:white; padding:12px 22px; font-size:16px; border-radius:10px; cursor:pointer;}
    .gen-btn:hover{ background:#163d6b;}
    .output-box{ background:#f8fafc; border-left:5px solid #1d4e89; padding:20px; border-radius:12px; min-height:150px; white-space:pre-wrap; }
</style>

</head>
<body>

<div class="header">
    <img src="Ascend_Horiz_Logo.png" class="logo">
    <h1>Hi, Kevin</h1>
    <div class="subtext">Every dial is a doorway to an opportunity.</div>
</div>

<div class="workhub">
    <div id="statusBanner" class="status-banner">YOU ARE CLOCKED IN</div>
    <div id="errorBanner" class="error-banner"></div>
    <div id="clockedTime" class="clocked-time"></div>

    <div class="clock-btns">
        <button id="clockInBtn" class="clock-btn clock-in">Clock In</button>
        <button id="clockOutBtn" class="clock-btn clock-out disabled" disabled>Clock Out</button>
    </div>

    <div class="stats-box">
        <div id="hoursToday">Today's Hours: 0.00</div>
        <div id="weekHours" class="secondary">This Week: 0.00 / 20 hrs</div>
        <div id="remainingHours" class="secondary"></div>
    </div>

    <div class="progress-bar-bg">
        <div id="weeklyProgress" class="progress-bar-fill"></div>
    </div>
</div>

<!-- AGENTS -->
<div class="agent-container">
    <div class="agent-card">
        <h2>Mike Frybarger</h2>
        <button class="btn">Calendly (coming soon)</button>
        <button class="btn">Homebot (coming soon)</button>
    </div>

    <div class="agent-card">
        <h2>Henry Ulrich</h2>
        <a href="https://calendly.com/henryroy" target="_blank"><button class="btn">Schedule w/ Henry</button></a>
        <a href="https://hmbt.co/fUNkbh" target="_blank"><button class="btn">Homebot Seller</button></a>
    </div>

    <div class="agent-card">
        <h2>Megan Dickerson</h2>
        <a href="https://calendly.com/megandickerson-realestate" target="_blank"><button class="btn">Schedule w/ Megan</button></a>
        <a href="https://get.homebot.ai/?id=14257442-1eec-49ec-b010-21fb01435f4b" target="_blank"><button class="btn">Homebot Seller</button></a>
    </div>
</div>

<!-- ASSIGNMENT LOGGER -->
<div class="assignment-card">
    <h2>Appointment + Homebot Assignment</h2>

    <div id="nextUpBox" class="next-up-box">Loading...</div>

    <div class="assignment-form">
        <select id="assignType">
            <option value="Appointment">Appointment</option>
            <option value="Homebot">Homebot Signup</option>
        </select>

        <input id="assignName" placeholder="Client Name">
        <input id="assignEmail" placeholder="Client Email">
        <input id="assignPhone" placeholder="Client Phone">
        <input id="assignAddress" placeholder="Client Address">
        <textarea id="assignNotes" placeholder="Notes..."></textarea>

        <button class="assign-btn" onclick="submitAssignment()">Submit Assignment</button>
    </div>
</div>

<!-- SCRIPT GENERATOR -->
<div class="generator-card">
    <h2>ISA Script Generator</h2>

    <div class="generator-row">
        <button class="gen-btn" onclick="generateColdHooks()">Cold Call Intros</button>
        <button class="gen-btn" onclick="generateWarmHooks()">Warm Buyer Follow-Up</button>

        <select id="objectionSelect">
            <option value="notSelling">“We're not selling.”</option>
            <option value="haveAgent">“We have an agent.”</option>
            <option value="spring">“Waiting until spring.”</option>
            <option value="justLooking">“Just browsing.”</option>
            <option value="notInterested">“Not interested.”</option>
            <option value="stopCalling">“Stop calling.”</option>
            <option value="rental">“Keeping it as a rental.”</option>
            <option value="generic">General</option>
        </select>

        <button class="gen-btn" onclick="generateObjections()">Handle Objection</button>
    </div>

    <div id="output" class="output-box">Click a button…</div>
</div>

<script>
/* BACKEND URL */
const API_URL = "https://script.google.com/macros/s/AKfycbyh3zwM_Aph-DEgwxBEGrMZow5SB3jXYrRGg3zQfWP4IA71tub1OGffukrtNL-OBZD5/exec";

/* ---------------- CLOCK ---------------- */
async function refreshClock(){
    const res = await fetch(API_URL);
    const data = await res.json();

    document.getElementById("hoursToday").innerText = "Today's Hours: " + (data.todayHours||0).toFixed(2);
    document.getElementById("weekHours").innerText = "This Week: " + (data.weekHours||0).toFixed(2) + " / 20 hrs";
    document.getElementById("remainingHours").innerText = "Remaining This Week: " + (data.remainingHours||0).toFixed(2);

    let pct = Math.min((data.weekHours/20)*100,100);
    const bar = document.getElementById("weeklyProgress");
    bar.style.width = pct+"%";
    bar.className = "progress-bar-fill " + (pct<50?"green":pct<90?"yellow":"red");

    if(data.isClockedIn){
        document.getElementById("statusBanner").style.display="block";
        document.getElementById("clockOutBtn").disabled=false;
        document.getElementById("clockOutBtn").classList.remove("disabled");
        document.getElementById("clockInBtn").disabled=true;
        document.getElementById("clockInBtn").classList.add("disabled");
    } else {
        document.getElementById("statusBanner").style.display="none";
        document.getElementById("clockOutBtn").disabled=true;
        document.getElementById("clockOutBtn").classList.add("disabled");
        document.getElementById("clockInBtn").disabled=false;
        document.getElementById("clockInBtn").classList.remove("disabled");
    }
}

document.getElementById("clockInBtn").onclick=async()=>{
    await fetch(API_URL+"?action=clock&event=Clock+In",{method:"POST"});
    refreshClock();
};
document.getElementById("clockOutBtn").onclick=async()=>{
    await fetch(API_URL+"?action=clock&event=Clock+Out",{method:"POST"});
    refreshClock();
};

refreshClock();
setInterval(refreshClock,15000);

/* ---------------- ROUND ROBIN ---------------- */
async function loadNextUp(){
    const res = await fetch(API_URL+"?action=roundrobin",{method:"POST"});
    const data = await res.json();
    document.getElementById("nextUpBox").innerText =
        `Next Appointment: ${data.Appointment} | Next Homebot: ${data.Homebot}`;
}
loadNextUp();
setInterval(loadNextUp,15000);

/* ---------------- ASSIGN ---------------- */
async function submitAssignment(){
    const type = document.getElementById("assignType").value;
    const name = document.getElementById("assignName").value;
    const email = document.getElementById("assignEmail").value;
    const phone = document.getElementById("assignPhone").value;
    const addr = document.getElementById("assignAddress").value;
    const notes = document.getElementById("assignNotes").value;

    const url = `${API_URL}?action=assign&category=${type}&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&phone=${encodeURIComponent(phone)}&address=${encodeURIComponent(addr)}&notes=${encodeURIComponent(notes)}`;

    const res = await fetch(url,{method:"POST"});
    const data = await res.json();

    alert("Assigned to " + data.assignedTo);

    document.getElementById("assignName").value="";
    document.getElementById("assignEmail").value="";
    document.getElementById("assignPhone").value="";
    document.getElementById("assignAddress").value="";
    document.getElementById("assignNotes").value="";

    loadNextUp();
}

/* SCRIPT GENERATOR ( unchanged ) */
function generateColdHooks(){
    document.getElementById("output").textContent =
        ["Hey this is Kevin with Ascend Realty…",
         "Do you follow the activity in your neighborhood?",
         "If prices jumped, would you want a heads-up?"]
         .map(x=>"• "+x).join("\n\n");
}
function generateWarmHooks(){
    document.getElementById("output").textContent =
        ["Hey I saw you browsing on our site…",
         "Are you casually looking or planning a move?",
         "Anything specific you're hoping to find?"]
        .map(x=>"• "+x).join("\n\n");
}
function generateObjections(){
    const o=document.getElementById("objectionSelect").value;
    const r={
        notSelling:["Totally fair, most aren’t selling right now…","If the market shifted in your favor would you want a quick update?"],
        haveAgent:["Awesome that you already have someone…","When's the last time they updated your home's value?"],
        rental:["Nice, rentals do well here…","How long do you plan to hold it?"],
        generic:["Totally get it…","When’s the last time you checked your equity?"]
    };
    document.getElementById("output").textContent = r[o].map(x=>"• "+x).join("\n\n");
}
</script>

</body>
</html>
